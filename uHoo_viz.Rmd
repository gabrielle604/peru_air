---
title: "uHoo_viz"
author: "Gabrielle"
date: "2025-08-20"
output: html_document
editor_options: 
  markdown: 
    wrap: 72
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(ggplot2)
library(dplyr)
library(tidyr)
library(tidyverse)
library(googlesheets4)
```

## Puente Piedra Pollution Data via uHoo Devices

- Number of devices: 4 
        - Is there no device number 3? (I only see uHoo 1,uHoo 2, uHoo 4, and uHoo 5 
    - Were they kept in the same location & home, or were they moved? 

- (looking at the “compare” tab with historical data..) 
    - Start Date: 22 February 2025 
    - End Date: 24 March 2025


AQI Table from U.S. Environmental Protection Agency and National Oceanic and Atmospheric Administration
[NOAA](https://www.weather.gov/abq/EmergencyPrepAirQuality "Explore the AQI Chart")


``` {r, out.width="50%", fig.align='center', echo=FALSE}
knitr::include_graphics("/Users/gabriellebenoit/Documents/GitHub/peru_air/AQI.png")
```

##### Purple Air - alternative air quality monitoring option
PurpleAir is a global initiative that provides accessible and hyper-local air quality monitoring through a network of privately owned sensors widely distributed in neighborhoods, schools, and homes. The sensors use a fan to draw air past a laser, where light scattered by airborne particles is measured—the intensity of this scattered light corresponds to the concentration of particulate matter (PM2.5 and PM10). All data is publicly accessible through PurpleAir's interactive dashboard map, creating a real-time citizen science network that complements official government air quality stations, which tend to be fewer in number and provide less comprehensive geographic coverage.

[PurpleAir](https://map.purpleair.com/air-quality-standards-us-epa-aqi?opt=%2F1%2Flp%2Fa10%2Fp604800%2FcC0#1/25/-30 "Explore the Interactive Map")

#### uHoo, data source for this project
uHoo is an air monitoring system that analyzes indoor air quality and provides detailed information about pollutants and other factors affecting air quality. It measures nine different parameters (listed below) and connects to both an individual/private web dashboard and to a smartphone app. The user is able to track real-time and historical data, receive notifications about harmful air conditions, and integrate with other 'smart' home devices. 

[uHoo](https://getuhoo.com/ "Explore the uHoo Device")


#### Measures:

1.  Temperatures Quick estimate - double the Celsius temperature,
    subtract 10%, and then add 32.
2.  Humidity
3.  Air pressure
4.  Carbon dioxide
5.  TVOC (Total Volatile Organic Compounds)
6.  PM2.5
7.  Nitrogen Dioxide
8.  Carbon Monoxide
9.  Ozone

#### Virus Index:
Correlational studies linking infectivity to poor air quality
  - Temperature: Optimum range: 19 °C to 24 °C
      - Cool, but not too cold
  - Humidity: Optimum range: 40% to 60%
      - Low humidity leads to dry nasal passage and increased vulnerability to cold viruses
      - High humidity is associated with mold growth, which can be harmful to people with less robust immune system
  - PM2.5: Optimum range: Below 13 μg/m3
      - Particulate matter that is smaller than 2.5 microns can be inhaled deep into the lungs, cause irritation and corrosion of the alveolar wall, and impair lung function
        - PM2.5 are known to carry microbes
      - Use proper ventilation while cooking, too
  - Carbon Dioxide: Optimum range: Below 800 ppm
      - High levels indicate poor ventilation, and can result in lung inflammation
      - Exposure to high levels for long periods of time can cause fatigue, headaches, and dizziness
  - Nitrogen Dioxide: Optimum range: Below 54 ppb
      - Short term exposure irritates the airways
      - Long term exposure can result in chronic respiratory illnesses, particularly for people with asthma

#### Mold Index: 
  - Temperature: Optimum range: 20 °C to 25 °C
      - Mold thrives in warm, humid environments; monitor temperature and humidity to reduce risk of mold growth
  - Humidity: Optimum range: 30% to 50%
      - Maintaining proper indoor humidity levels can significantly reduce the risk of mold
      - Control moisture generative activities such as cooking and bathing
  - Carbon Dioxide: Optimum range: Below 800 ppm
      - Indicator of poor spatial ventilation
      - Increased risk of lung inflammation 
  - PM2.5: Optimum range: Below 15 μg/m3
      - Not a direct link, but can exacerbate asthma effects of mold exposure

#### Discomfort Index: 
  - Humidity: Optimum range 40-55%
      - Bad (Humid): Irritable, higher levels of dust mites, bacteria, and fungi are in the air
      - Severe Humidity
          - Clammy, sweaty; prolonged exposure can result in overheating, increased heart rate and respiration, and muscle cramps

#### Google Sheet with Manually Retrieved uHoo Air Quality Data

[uHoo Data for brief investigation](https://docs.google.com/spreadsheets/d/1DDBmP87x2qYeGHrDIL4s2tVYbPjKI0qkHL10f0_asYM/edit?gid=982448321#gid=982448321 "Explore the data")

Comment regarding sheet: data_for_R
- This data is gathered from looking at the "compare" section of uHoo and setting the monitor to each device (i.e. uHoo (DA82)) and then selecting the indicator (i.e. temperature) and then manually noting the high and the low for both March 1st and March 18th. I don't think the data in the Analytics tab is correct (there are negative humidity readings and super high TVOC readings... could be from the first 24hours after setup of the device that can be inaccurate. There is also no way to export/download the data - I could try reaching out to the company to get an API though, possibly.
```{r googlesheet, include = FALSE}
gs4_auth()

google_sheet_url <- "https://docs.google.com/spreadsheets/d/1DDBmP87x2qYeGHrDIL4s2tVYbPjKI0qkHL10f0_asYM/edit?gid=982448321#gid=982448321" # Replace with your sheet URL
uhoo_data <- read_sheet(google_sheet_url, sheet = "data_for_R")

```



#### Guide for figures:

Bar Plot of High and Low Temps by Device: emphasizes differences across
devices

Point Range Plot: visually summarizes the variability per device

Plot with dates included -- only analyzed Saturday, March 1st, 2025 &
Tuesday, March 18th, 2025

#### Temperature

```{r temperature, echo=FALSE}
# Create the temperature dataset
df <- data.frame(
  Device = c("uHoo 1 (DA82)", "uHoo 2 (EEDC)", "uHoo 4 (59E1)", "uHoo 5 (60B6)",
             "uHoo 1 (DA82)", "uHoo 2 (EEDC)", "uHoo 4 (59E1)", "uHoo 5 (60B6)"),
  Day = as.Date(c("2025-03-01", "2025-03-01", "2025-03-01", "2025-03-01",
                  "2025-03-18", "2025-03-18", "2025-03-18", "2025-03-18")),
  High = c(26.3, 26.9, 27.0, 27.4, 23.0, 24.8, 23.4, 23.7),
  Low = c(21.8, 22.4, 23.0, 22.4, 19.6, 21.3, 20.5, 20.5)
)

# Average by device
df_summary <- df %>%
  group_by(Device) %>%
  summarise(High = mean(High), Low = mean(Low))

# Reshape to long format
df_long <- df_summary %>%
  pivot_longer(cols = c(High, Low), names_to = "Type", values_to = "Temperature")

# Bar plot
ggplot(df_long, aes(x = Device, y = Temperature, fill = Type)) +
  geom_bar(stat = "identity", position = position_dodge()) +
  labs(title = "Average High and Low Temperature by Device",
       x = "Device", y = "Temperature (°C)") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

# Plot temperature range
ggplot(df_summary, aes(x = Device)) +
  geom_pointrange(aes(ymin = Low, ymax = High, y = (Low + High)/2)) +
  labs(title = "Temperature Range by Device",
       x = "Device", y = "Temperature (°C)") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

# Long format with Day included
df_long2 <- df %>%
  pivot_longer(cols = c(High, Low), names_to = "Type", values_to = "Temperature")

ggplot(df_long2, aes(x = Day, y = Temperature, color = Type, group = Type)) +
  geom_point() +
  geom_line() +
  facet_wrap(~ Device) +
  labs(title = "Temperature by Date and Device",
       x = "Day", y = "Temperature (°C)") +
  theme_minimal()


```

#### Humidity

```{r humidity, echo=FALSE}
# Manually entering the humidity data without % symbols
df <- data.frame(
  Device = c("uHoo 1 (DA82)", "uHoo 2 (EEDC)", "uHoo 4 (59E1)", "uHoo 5 (60B6)",
             "uHoo 1 (DA82)", "uHoo 2 (EEDC)", "uHoo 4 (59E1)", "uHoo 5 (60B6)"),
  Day = as.Date(c("2025-03-01", "2025-03-01", "2025-03-01", "2025-03-01",
                  "2025-03-18", "2025-03-18", "2025-03-18", "2025-03-18")),
  High = c(83.8, 90.5, 87.4, 89.8, 84.5, 86.3, 89.7, 89.3),
  Low = c(65.7, 73.2, 72.7, 71.4, 69.9, 72.8, 77.5, 77.1)
)

# Average across days by device
df_summary <- df %>%
  group_by(Device) %>%
  summarise(High = mean(High), Low = mean(Low))

# Reshape to long format
df_long <- df_summary %>%
  pivot_longer(cols = c(High, Low), names_to = "Type", values_to = "Humidity")

# Bar plot
ggplot(df_long, aes(x = Device, y = Humidity, fill = Type)) +
  geom_bar(stat = "identity", position = position_dodge()) +
  labs(title = "Average High and Low Humidity by Device",
       x = "Device", y = "Humidity (%)") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

ggplot(df_summary, aes(x = Device)) +
  geom_pointrange(aes(ymin = Low, ymax = High, y = (Low + High)/2)) +
  labs(title = "Humidity Range by Device",
       x = "Device", y = "Humidity (%)") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

# Reshape with Day preserved
df_long2 <- df %>%
  pivot_longer(cols = c(High, Low), names_to = "Type", values_to = "Humidity")

ggplot(df_long2, aes(x = Day, y = Humidity, color = Type, group = Type)) +
  geom_point() +
  geom_line() +
  facet_wrap(~ Device) +
  labs(title = "Humidity by Date and Device",
       x = "Day", y = "Humidity (%)") +
  theme_minimal()
```

#### Carbon Dioxide

```{r carbon dioxide, echo=FALSE}

# Enter CO₂ data, removing "ppm" and converting to numeric
df <- data.frame(
  Device = c("uHoo 1 (DA82)", "uHoo 2 (EEDC)", "uHoo 4 (59E1)", "uHoo 5 (60B6)",
             "uHoo 1 (DA82)", "uHoo 2 (EEDC)", "uHoo 4 (59E1)", "uHoo 5 (60B6)"),
  Day = as.Date(c("2025-03-01", "2025-03-01", "2025-03-01", "2025-03-01",
                  "2025-03-18", "2025-03-18", "2025-03-18", "2025-03-18")),
  High = c(581, 0, 840, 594, 549, 0, 714, 586),
  Low = c(526, 0, 777, 542, 523, 0, 680, 542)
)

# Average across timepoints
df_summary <- df %>%
  group_by(Device) %>%
  summarise(High = mean(High), Low = mean(Low))

# Reshape to long format
df_long <- df_summary %>%
  pivot_longer(cols = c(High, Low), names_to = "Type", values_to = "CO2")

# Bar plot
ggplot(df_long, aes(x = Device, y = CO2, fill = Type)) +
  geom_bar(stat = "identity", position = position_dodge()) +
  labs(title = "Average High and Low CO2 Levels by Device",
       x = "Device", y = "CO2 (ppm)") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

ggplot(df_summary, aes(x = Device)) +
  geom_pointrange(aes(ymin = Low, ymax = High, y = (Low + High)/2)) +
  labs(title = "CO2 Range by Device",
       x = "Device", y = "CO2 (ppm)") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

# Reshape for plotting with Day and Type
df_long2 <- df %>%
  pivot_longer(cols = c(High, Low), names_to = "Type", values_to = "CO2")

ggplot(df_long2, aes(x = Day, y = CO2, color = Type, group = Type)) +
  geom_point() +
  geom_line() +
  facet_wrap(~ Device) +
  labs(title = "CO2 Levels by Date and Device",
       x = "Day", y = "CO2 (ppm)") +
  theme_minimal()

```

#### Total Volatile Organic Compounds

```{r TOVC, echo=FALSE}

# Manually entering and cleaning the data
df <- data.frame(
  Device = c("uHoo 1 (DA82)", "uHoo 2 (EEDC)", "uHoo 4 (59E1)", "uHoo 5 (60B6)",
             "uHoo 1 (DA82)", "uHoo 2 (EEDC)", "uHoo 4 (59E1)", "uHoo 5 (60B6)"),
  Day = as.Date(c("2025-03-01", "2025-03-01", "2025-03-01", "2025-03-01",
                  "2025-03-18", "2025-03-18", "2025-03-18", "2025-03-18")),
  High = c(1896, 2812, 208, 1986, 980, 10330, 870, 2792),
  Low  = c(183, 1100, 2, 7, 0, 374, 2, 11)
)

# Average across dates per device
df_summary <- df %>%
  group_by(Device) %>%
  summarise(High = mean(High), Low = mean(Low))

# Reshape to long format
df_long <- df_summary %>%
  pivot_longer(cols = c(High, Low), names_to = "Type", values_to = "TVOC")

# Bar plot
ggplot(df_long, aes(x = Device, y = TVOC, fill = Type)) +
  geom_bar(stat = "identity", position = position_dodge()) +
  labs(title = "Average High and Low TVOC by Device",
       x = "Device", y = "TVOC (ppb)") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

ggplot(df_summary, aes(x = Device)) +
  geom_pointrange(aes(ymin = Low, ymax = High, y = (Low + High)/2)) +
  labs(title = "TVOC Range by Device",
       x = "Device", y = "TVOC (ppb)") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

# Reshape with Day preserved
df_long2 <- df %>%
  pivot_longer(cols = c(High, Low), names_to = "Type", values_to = "TVOC")

ggplot(df_long2, aes(x = Day, y = TVOC, color = Type, group = Type)) +
  geom_point() +
  geom_line() +
  facet_wrap(~ Device) +
  labs(title = "TVOC by Date and Device",
       x = "Day", y = "TVOC (ppb)") +
  theme_minimal()

```

#### Particulate Matter 2.5 micrometers

```{r PM2.5, echo=FALSE}

# Manually entering and cleaning the data
df <- data.frame(
  Device = c("uHoo 1 (DA82)", "uHoo 2 (EEDC)", "uHoo 4 (59E1)", "uHoo 5 (60B6)",
             "uHoo 1 (DA82)", "uHoo 2 (EEDC)", "uHoo 4 (59E1)", "uHoo 5 (60B6)"),
  Day = as.Date(c("2025-03-01", "2025-03-01", "2025-03-01", "2025-03-01",
                  "2025-03-18", "2025-03-18", "2025-03-18", "2025-03-18")),
  High = c(13, 12, 11, 8, 18, 30, 12, 13),
  Low  = c(4, 4, 6, 2, 10, 11, 7, 6)
)

# Average across dates per device
df_summary <- df %>%
  group_by(Device) %>%
  summarise(High = mean(High), Low = mean(Low))

# Reshape to long format
df_long <- df_summary %>%
  pivot_longer(cols = c(High, Low), names_to = "Type", values_to = "PM2_5")

# Bar plot
ggplot(df_long, aes(x = Device, y = PM2_5, fill = Type)) +
  geom_bar(stat = "identity", position = position_dodge()) +
  labs(title = "Average High and Low PM2.5 by Device",
       x = "Device", y = "PM2.5 (µg/m³)") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

# Point-range plot
ggplot(df_summary, aes(x = Device)) +
  geom_pointrange(aes(ymin = Low, ymax = High, y = (Low + High)/2)) +
  labs(title = "PM2.5 Range by Device",
       x = "Device", y = "PM2.5 (µg/m³)") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

# Reshape with Day preserved
df_long2 <- df %>%
  pivot_longer(cols = c(High, Low), names_to = "Type", values_to = "PM2_5")

# Line plot over time
ggplot(df_long2, aes(x = Day, y = PM2_5, color = Type, group = Type)) +
  geom_point() +
  geom_line() +
  facet_wrap(~ Device) +
  labs(title = "PM2.5 by Date and Device",
       x = "Day", y = "PM2.5 (µg/m³)") +
  theme_minimal()

```

#### Nitrogen Dioxide

```{r nitrogen dioxide, echo=FALSE}

# Manually entering and cleaning the data
df <- data.frame(
  Device = c("uHoo 1 (DA82)", "uHoo 2 (EEDC)", "uHoo 4 (59E1)", "uHoo 5 (60B6)",
             "uHoo 1 (DA82)", "uHoo 2 (EEDC)", "uHoo 4 (59E1)", "uHoo 5 (60B6)"),
  Day = as.Date(c("2025-03-01", "2025-03-01", "2025-03-01", "2025-03-01",
                  "2025-03-18", "2025-03-18", "2025-03-18", "2025-03-18")),
  High = c(9, 77, 12, 1, 17, 58, 18, 33),
  Low  = c(0, 0, 0, 0, 0, 1, 0, 0)
)

# Average across dates per device
df_summary <- df %>%
  group_by(Device) %>%
  summarise(High = mean(High), Low = mean(Low))

# Reshape to long format
df_long <- df_summary %>%
  pivot_longer(cols = c(High, Low), names_to = "Type", values_to = "NO2")

# Bar plot
ggplot(df_long, aes(x = Device, y = NO2, fill = Type)) +
  geom_bar(stat = "identity", position = position_dodge()) +
  labs(title = "Average High and Low Nitrogen Dioxide by Device",
       x = "Device", y = "NO2 (ppb)") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

# Point-range plot
ggplot(df_summary, aes(x = Device)) +
  geom_pointrange(aes(ymin = Low, ymax = High, y = (Low + High)/2)) +
  labs(title = "Nitrogen Dioxide Range by Device",
       x = "Device", y = "NO2 (ppb)") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

# Reshape with Day preserved
df_long2 <- df %>%
  pivot_longer(cols = c(High, Low), names_to = "Type", values_to = "NO2")

# Line plot over time
ggplot(df_long2, aes(x = Day, y = NO2, color = Type, group = Type)) +
  geom_point() +
  geom_line() +
  facet_wrap(~ Device) +
  labs(title = "Nitrogen Dioxide by Date and Device",
       x = "Day", y = "NO2 (ppb)") +
  theme_minimal()

```

#### Carbon Monoxide

```{r carbon monoxide, echo=FALSE}

# Manually entering and cleaning the data
df <- data.frame(
  Device = c("uHoo 1 (DA82)", "uHoo 2 (EEDC)", "uHoo 4 (59E1)", "uHoo 5 (60B6)",
             "uHoo 1 (DA82)", "uHoo 2 (EEDC)", "uHoo 4 (59E1)", "uHoo 5 (60B6)"),
  Day = as.Date(c("2025-03-01", "2025-03-01", "2025-03-01", "2025-03-01",
                  "2025-03-18", "2025-03-18", "2025-03-18", "2025-03-18")),
  High = c(0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0),
  Low  = c(0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0)
)

# Average across dates per device
df_summary <- df %>%
  group_by(Device) %>%
  summarise(High = mean(High), Low = mean(Low))

# Reshape to long format
df_long <- df_summary %>%
  pivot_longer(cols = c(High, Low), names_to = "Type", values_to = "CO")

# Bar plot
ggplot(df_long, aes(x = Device, y = CO, fill = Type)) +
  geom_bar(stat = "identity", position = position_dodge()) +
  labs(title = "Average High and Low Carbon Monoxide by Device",
       x = "Device", y = "CO (ppm)") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

# Point-range plot
ggplot(df_summary, aes(x = Device)) +
  geom_pointrange(aes(ymin = Low, ymax = High, y = (Low + High)/2)) +
  labs(title = "Carbon Monoxide Range by Device",
       x = "Device", y = "CO (ppm)") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

# Reshape with Day preserved
df_long2 <- df %>%
  pivot_longer(cols = c(High, Low), names_to = "Type", values_to = "CO")

# Line plot over time
ggplot(df_long2, aes(x = Day, y = CO, color = Type, group = Type)) +
  geom_point() +
  geom_line() +
  facet_wrap(~ Device) +
  labs(title = "Carbon Monoxide by Date and Device",
       x = "Day", y = "CO (ppm)") +
  theme_minimal()

```

#### Ozone

```{r ozone, echo=FALSE}

# Manually entering and cleaning the data
df <- data.frame(
  Device = c("uHoo 1 (DA82)", "uHoo 2 (EEDC)", "uHoo 4 (59E1)", "uHoo 5 (60B6)",
             "uHoo 1 (DA82)", "uHoo 2 (EEDC)", "uHoo 4 (59E1)", "uHoo 5 (60B6)"),
  Day = as.Date(c("2025-03-01", "2025-03-01", "2025-03-01", "2025-03-01",
                  "2025-03-18", "2025-03-18", "2025-03-18", "2025-03-18")),
  High = c(7, 11, 8, 5, 8, 10, 8, 9),
  Low  = c(3, 7, 6, 4, 6, 7, 5, 4)
)

# Average across dates per device
df_summary <- df %>%
  group_by(Device) %>%
  summarise(High = mean(High), Low = mean(Low))

# Reshape to long format
df_long <- df_summary %>%
  pivot_longer(cols = c(High, Low), names_to = "Type", values_to = "O3")

# Bar plot
ggplot(df_long, aes(x = Device, y = O3, fill = Type)) +
  geom_bar(stat = "identity", position = position_dodge()) +
  labs(title = "Average High and Low Ozone by Device",
       x = "Device", y = "O3 (ppb)") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

# Point-range plot
ggplot(df_summary, aes(x = Device)) +
  geom_pointrange(aes(ymin = Low, ymax = High, y = (Low + High)/2)) +
  labs(title = "Ozone Range by Device",
       x = "Device", y = "O3 (ppb)") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

# Reshape with Day preserved
df_long2 <- df %>%
  pivot_longer(cols = c(High, Low), names_to = "Type", values_to = "O3")

# Line plot over time
ggplot(df_long2, aes(x = Day, y = O3, color = Type, group = Type)) +
  geom_point() +
  geom_line() +
  facet_wrap(~ Device) +
  labs(title = "Ozone by Date and Device",
       x = "Day", y = "O3 (ppb)") +
  theme_minimal()

```
